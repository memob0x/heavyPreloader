{"version":3,"sources":["loader.mjs"],"names":["global","factory","exports","module","define","amd","self","Loader","getURL","href","URL","a","document","createElement","createWorker","work","TypeError","url","createObjectURL","Blob","toString","type","worker","Worker","revokeObjectURL","onmessage","event","data","fetch","options","response","blob","message","status","statusText","postMessage","getOrCreateWorker","cache","fetch$1","Promise","resolve","reject","addEventListener","Error","cors","arg","Array","isArray","map","el","load","undefined","Image","imageUrl","onload","onerror","src","reader","FileReader","srcElement","result","readAsText","styleUrl","sheet","CSSStyleSheet","replace","adoptedStyleSheets","jsUrl"],"mappings":"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","file":"loader.es5.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Loader', factory) :\n    (global = global || self, global.Loader = factory());\n}(this, (function () { 'use strict';\n\n    /**\n     *\n     * @private\n     * @static\n     * @param {String} href\n     * @returns {URL}\n     */\n    const getURL = (href) =>\n        new URL(\n            ((a) => {\n                a.href = href;\n\n                return a;\n            })(document.createElement(\"a\"))\n        );\n\n    /**\n     *\n     * @private\n     * @static\n     * @param {Function} work\n     * @returns {Worker}\n     */\n    const createWorker = (work) => {\n        if (typeof work !== \"function\") {\n            throw new TypeError(\n                `Invalid argment of type ${typeof work} passed to Loader class internal \"createWorker\" function.`\n            );\n        }\n\n        const url = URL.createObjectURL(\n            new Blob([\"(\", work.toString(), \")()\"], {\n                type: \"application/javascript\",\n            })\n        );\n\n        const worker = new Worker(url);\n\n        URL.revokeObjectURL(url);\n\n        return worker;\n    };\n\n    /**\n     *\n     * @private\n     * @static\n     */\n    const work = () => {\n        onmessage = async (event) => {\n            const data = event.data;\n\n            // ...\n            let message;\n            try {\n                const response = await fetch(data.href, data.options);\n                const blob = await response.blob();\n\n                message = {\n                    status: response.status,\n                    statusText: response.statusText,\n                    blob: blob,\n                };\n            } catch (e) {\n                message = {\n                    status: 0,\n                    statusText: e,\n                };\n            }\n\n            // ...\n            message.href = data.href;\n            postMessage(message);\n        };\n    };\n\n    // ...\n    let worker = null;\n\n    /**\n     *\n     * @private\n     */\n    const getOrCreateWorker = () =>\n        worker ? worker : (worker = createWorker(work));\n\n    // ...\n    const cache = {};\n\n    /**\n     *\n     * @private\n     * @param {String} href\n     * @param {Object} options\n     */\n    var fetch$1 = async (href, options = {}) => {\n        // ...\n        if (href in cache) {\n            return await cache[href];\n        }\n\n        // ...\n        return (cache[href] = new Promise((resolve, reject) => {\n            const worker = getOrCreateWorker();\n\n            // ...\n            worker.postMessage({\n                href: href,\n                options: options.fetch,\n            });\n\n            // ...\n            worker.addEventListener(\"message\", (event) => {\n                const data = event.data;\n\n                // ...\n                if (data.href !== href) {\n                    return;\n                }\n\n                // ...\n                if (data.status === 200) {\n                    resolve(data.blob);\n\n                    return;\n                }\n\n                // ...\n                reject(new Error(`${data.statusText} for ${data.href} resource.`));\n            });\n        }));\n    };\n\n    class Loader {\n        /**\n         *\n         * @param {Object} options\n         */\n        constructor(options) {\n            this.options = {\n                ...{ fetch: { cors: \"no-cors\" } },\n                ...options,\n            };\n        }\n\n        /**\n         *\n         * @param {Array.<String>|Array.<URL>|String|URL} arg\n         * @returns {Array.<Promise>|Promise}\n         */\n        async fetch(arg) {\n            // ...\n            if (Array.isArray(arg)) {\n                return await arg.map((a) => this.fetch(a));\n            }\n\n            // ...\n            if (typeof arg === \"string\") {\n                return await this.fetch(getURL(arg));\n            }\n\n            // ...\n            if (arg instanceof URL) {\n                return await fetch$1(arg.href, this.options);\n            }\n\n            // ...\n            throw new TypeError(\n                `Invalid argment of type ${typeof arg} passed to Loader class \"fetch\" method.`\n            );\n        }\n\n        /**\n         *\n         * @param {Array.<String>|Array.<URL>|String|URL} arg\n         * @returns {Array.<Promise>|Promise}\n         */\n        async load(arg, el) {\n            // ...\n            if (Array.isArray(arg)) {\n                return await arg.map((a) => this.load(a));\n            }\n\n            // ...\n            const blob = await this.fetch(arg);\n\n            //...\n            switch (blob.type) {\n                //...\n                case \"image/png\":\n                case \"image/jpeg\":\n                    //\n                    el = undefined === el ? new Image() : el;\n\n                    //\n                    const imageUrl = URL.createObjectURL(blob);\n\n                    //\n                    await new Promise((resolve, reject) => {\n                        el.onload = resolve;\n                        el.onerror = reject;\n\n                        el.src = imageUrl;\n                    });\n\n                    //\n                    URL.revokeObjectURL(imageUrl);\n\n                    //\n                    return el;\n\n                //...\n                case \"text/html\":\n                    return new Promise((resolve, reject) => {\n                        //\n                        const reader = new FileReader();\n\n                        //\n                        reader.addEventListener(\"loadend\", (load) =>\n                            resolve(load.srcElement.result)\n                        );\n\n                        // TODO: error?\n\n                        //\n                        reader.readAsText(blob);\n                    });\n\n                //...\n                case \"text/css\":\n                    //\n                    el = undefined === el ? document : el;\n\n                    //\n                    const styleUrl = URL.createObjectURL(blob);\n\n                    //\n                    const sheet = new CSSStyleSheet();\n\n                    //\n                    await sheet.replace(`@import url(\"${styleUrl}\")`);\n\n                    //\n                    URL.revokeObjectURL(styleUrl);\n\n                    //\n                    if (\"adoptedStyleSheets\" in el) {\n                        el.adoptedStyleSheets = [...el.adoptedStyleSheets, sheet];\n                    }\n\n                    //\n                    return sheet;\n\n                //...\n                case \"text/javascript\":\n                    //\n                    const jsUrl = URL.createObjectURL(blob);\n\n                    //\n                    const result = await import(jsUrl);\n\n                    //\n                    URL.revokeObjectURL(jsUrl);\n\n                    //\n                    return result;\n            }\n\n            // ...\n            throw new TypeError(\n                `Invalid argment of type ${typeof arg} passed to Loader class \"fetch\" method.`\n            );\n        }\n    }\n\n    return Loader;\n\n})));\n"]}