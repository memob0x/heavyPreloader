{"version":3,"sources":["loader.mjs"],"names":["global","factory","exports","module","define","amd","self","Loader","prop","o","p","split","reduce","xs","x","getURL","arg","a","document","createElement","href","URL","isSupportedElement","el","HTMLImageElement","HTMLPictureElement","HTMLSourceElement","HTMLVideoElement","HTMLAudioElement","createWorker","work","url","createObjectURL","Blob","toString","type","worker","Worker","revokeObjectURL","getLoaderType","ext","length","isCORS","hostname","window","location","protocol","collection","WeakMap","build","data","blob","LoaderResource","override","has","get","set","loadImage","Image","Promise","resolve","reject","onload","onerror","src","loadMedia","loadStyle","sheet","CSSStyleSheet","promise","replace","adoptedStyleSheets","loadObject","width","height","body","append","loadScript","async","head","Loaders","image","bool","media","script","style","onmessage","event","fetch","options","response","message","status","statusText","postMessage","loaderWorker","collection$1","_fetch","resource","then","r","cors","_load","addEventListener","Error","NodeList","Array","isArray","map","isLoaderResource","load"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAC,WAAUA,MAAV,EAAkBC,OAAlB,EAA2B;AACxB,UAAOC,OAAP,yCAAOA,OAAP,OAAmB,QAAnB,IAA+B,OAAOC,MAAP,KAAkB,WAAjD,GAA+DA,MAAM,CAACD,OAAP,GAAiBD,OAAO,EAAvF,GACA,OAAOG,MAAP,KAAkB,UAAlB,IAAgCA,MAAM,CAACC,GAAvC,GAA6CD,MAAM,CAAC,QAAD,EAAWH,OAAX,CAAnD,IACCD,MAAM,GAAGA,MAAM,IAAIM,IAAnB,EAAyBN,MAAM,CAACO,MAAP,GAAgBN,OAAO,EADjD,CADA;AAGH,CAJA,UAIQ,YAAY;AAAE;;AAOnB,MAAMO,IAAI,GAAG,SAAPA,IAAO,CAACC,CAAD,EAAIC,CAAJ;AAAA,WACTA,CAAC,CAACC,KAAF,CAAQ,GAAR,EAAaC,MAAb,CAAoB,UAACC,EAAD,EAAKC,CAAL;AAAA,aAAYD,EAAE,IAAIA,EAAE,CAACC,CAAD,CAAR,GAAcD,EAAE,CAACC,CAAD,CAAhB,GAAsB,IAAlC;AAAA,KAApB,EAA6DL,CAA7D,CADS;AAAA,GAAb;;AAQA,MAAMM,MAAM,GAAG,SAATA,MAAS,CAAAC,GAAG,EAAI;AAClBA,IAAAA,GAAG,GAAGR,IAAI,CAACQ,GAAD,EAAM,KAAN,CAAJ,IAAoBA,GAA1B;AACAA,IAAAA,GAAG,GAAGR,IAAI,CAACQ,GAAD,EAAM,MAAN,CAAJ,IAAqBA,GAA3B;AAEA,QAAMC,CAAC,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAV;AACAF,IAAAA,CAAC,CAACG,IAAF,GAASJ,GAAT;AAEA,WAAO,IAAIK,GAAJ,CAAQJ,CAAR,CAAP;AACH,GARD;;AAeA,MAAMK,kBAAkB,GAAG,SAArBA,kBAAqB,CAAAC,EAAE,EAAI;AAC7B,WACIA,EAAE,YAAYC,gBAAd,IACAD,EAAE,YAAYE,kBADd,IAEAF,EAAE,YAAYG,iBAFd,IAGAH,EAAE,YAAYI,gBAHd,IAIAJ,EAAE,YAAYK,gBALlB;AAOH,GARD;;AAeA,MAAMC,YAAY,GAAG,SAAfA,YAAe,CAAAC,IAAI,EAAI;AACzBA,IAAAA,IAAI,GAAG,OAAOA,IAAP,KAAgB,UAAhB,GAA6B,YAAM,CAAE,CAArC,GAAwCA,IAA/C;AAEA,QAAMC,GAAG,GAAGV,GAAG,CAACW,eAAJ,CACR,IAAIC,IAAJ,CAAS,CAAC,GAAD,EAAMH,IAAI,CAACI,QAAL,EAAN,EAAuB,KAAvB,CAAT,EAAwC;AACpCC,MAAAA,IAAI,EAAE;AAD8B,KAAxC,CADQ,CAAZ;AAMA,QAAMC,MAAM,GAAG,IAAIC,MAAJ,CAAWN,GAAX,CAAf;AAEAV,IAAAA,GAAG,CAACiB,eAAJ,CAAoBP,GAApB;AAEA,WAAOK,MAAP;AACH,GAdD;;AAoBA,MAAMG,aAAa,GAAG,SAAhBA,aAAgB,CAAAvB,GAAG,EAAI;AACzBA,IAAAA,GAAG,GAAGD,MAAM,CAACC,GAAD,CAAN,CAAYI,IAAlB;AAEA,QAAIoB,GAAG,GAAGxB,GAAG,CAACL,KAAJ,CAAU,GAAV,CAAV;AACA6B,IAAAA,GAAG,GAAGA,GAAG,CAACA,GAAG,CAACC,MAAJ,GAAa,CAAd,CAAT;;AAEA,YAAQD,GAAR;AACI,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,MAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,MAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,MAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,MAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACI,eAAO,OAAP;;AACJ,WAAK,KAAL;AACI,eAAO,OAAP;;AACJ,WAAK,IAAL;AACA,WAAK,KAAL;AACI,eAAO,QAAP;;AACJ,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,KAAL;AACA,WAAK,MAAL;AACI,eAAO,OAAP;;AACJ;AACI,eAAO,MAAP;AAnCR;AAqCH,GA3CD;;AAkDA,MAAME,MAAM,GAAG,SAATA,MAAS,CAAA1B,GAAG,EAAI;AAClBA,IAAAA,GAAG,GAAGD,MAAM,CAACC,GAAD,CAAZ;AAEA,WACIA,GAAG,CAAC2B,QAAJ,KAAiBC,MAAM,CAACC,QAAP,CAAgBF,QAAjC,IACA3B,GAAG,CAAC8B,QAAJ,KAAiBF,MAAM,CAACC,QAAP,CAAgBC,QAFrC;AAIH,GAPD;;AAUA,MAAMC,UAAU,GAAG,IAAIC,OAAJ,EAAnB;;AAGA,MAAMC,KAAK,GAAG,SAARA,KAAQ,CAAAC,IAAI,EAAI;AAClB,QAAIzC,CAAC,GAAG,EAAR;;AAEA,QAAIa,kBAAkB,CAAC4B,IAAD,CAAtB,EAA8B;AAC1BzC,MAAAA,CAAC,CAACc,EAAF,GAAO2B,IAAP;AACAzC,MAAAA,CAAC,CAACsB,GAAF,GAAQhB,MAAM,CAACP,IAAI,CAACC,CAAC,CAACc,EAAH,EAAO,aAAP,CAAL,CAAd;AACH,KAHD,MAGO;AACHd,MAAAA,CAAC,CAACc,EAAF,GAAOf,IAAI,CAAC0C,IAAD,EAAO,IAAP,CAAX;AACAzC,MAAAA,CAAC,CAACsB,GAAF,GAAQmB,IAAI,YAAY7B,GAAhB,GAAsB6B,IAAtB,GAA6B1C,IAAI,CAAC0C,IAAD,EAAO,KAAP,CAAzC;AACH;;AAEDzC,IAAAA,CAAC,CAAC0C,IAAF,GAAS3C,IAAI,CAAC0C,IAAD,EAAO,MAAP,CAAb;AAEA,WAAOzC,CAAP;AACH,GAdD;;AAhIiB,MAkJX2C,cAlJW;AAmJb,4BAAYF,IAAZ,EAAkBG,QAAlB,EAA4B;AAAA;;AACxB,UAAI5C,CAAC,GAAGwC,KAAK,CAACC,IAAD,CAAb;;AAEA,UAAIH,UAAU,CAACO,GAAX,CAAe7C,CAAC,CAACsB,GAAjB,KAAyB,CAACsB,QAA9B,EAAwC;AACpC5C,QAAAA,CAAC,GAAGsC,UAAU,CAACQ,GAAX,CAAe9C,CAAC,CAACsB,GAAjB,CAAJ;AACH;;AAED,UAAIgB,UAAU,CAACO,GAAX,CAAe7C,CAAC,CAACc,EAAjB,KAAwB,CAAC8B,QAA7B,EAAuC;AACnC5C,QAAAA,CAAC,GAAGsC,UAAU,CAACQ,GAAX,CAAe9C,CAAC,CAACc,EAAjB,CAAJ;AACH;;AAED,WAAKA,EAAL,GAAUd,CAAC,CAACc,EAAZ;AACA,WAAKQ,GAAL,GAAWtB,CAAC,CAACsB,GAAb;AACA,WAAKoB,IAAL,GAAY1C,CAAC,CAAC0C,IAAd;AAEAJ,MAAAA,UAAU,CAACS,GAAX,CAAe/C,CAAC,CAACc,EAAF,IAAQd,CAAC,CAACsB,GAAzB,EAA8B,IAA9B;AACH;;AAnKY;AAAA;AAAA,uCAqKWmB,IArKX,EAqKiB;AAC1B,eAAOA,IAAI,YAAY,IAAvB;AACH;AAvKY;;AAAA;AAAA;;AA0KjB,MAAMO,SAAS,GAAG,SAAZA,SAAY,CAAC1B,GAAD;AAAA,QAAMR,EAAN,uEAAW,IAAImC,KAAJ,EAAX;AAAA,WACd,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAC7BtC,MAAAA,EAAE,CAACuC,MAAH,GAAY;AAAA,eAAMF,OAAO,CAACrC,EAAD,CAAb;AAAA,OAAZ;;AACAA,MAAAA,EAAE,CAACwC,OAAH,GAAaF,MAAb;AAEAtC,MAAAA,EAAE,CAACyC,GAAH,GAASjC,GAAT;AACH,KALD,CADc;AAAA,GAAlB;;AAQA,MAAMkC,SAAS,GAAG,SAAZA,SAAY,CAAClC,GAAD;AAAA,QAAMR,EAAN,uEAAW,IAAImC,KAAJ,EAAX;AAAA,WAEd,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAC7BtC,MAAAA,EAAE,CAACuC,MAAH,GAAY;AAAA,eAAMF,OAAO,CAACrC,EAAD,CAAb;AAAA,OAAZ;;AACAA,MAAAA,EAAE,CAACwC,OAAH,GAAaF,MAAb;AAEAtC,MAAAA,EAAE,CAACyC,GAAH,GAASjC,GAAT;AACH,KALD,CAFc;AAAA,GAAlB;;AASA,MAAMmC,SAAS,GAAG,SAAZA,SAAY,CAACnC,GAAD,EAA6C;AAAA,QAAvCR,EAAuC,uEAAlCL,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAkC;AAC3D,QAAMgD,KAAK,GAAG,IAAIC,aAAJ,EAAd;AAEA,QAAMC,OAAO,GAAGF,KAAK,CAACG,OAAN,yBAA8BvC,GAA9B,SAAhB;;AAEA,QAAI,wBAAwBR,EAA5B,EAAgC;AAC5BA,MAAAA,EAAE,CAACgD,kBAAH,gCAA4BhD,EAAE,CAACgD,kBAA/B,IAAmDJ,KAAnD;AACH;;AAED,WAAOE,OAAP;AACH,GAVD;;AAYA,MAAMG,UAAU,GAAG,SAAbA,UAAa,CAACzC,GAAD;AAAA,QAAMR,EAAN,uEAAWL,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAX;AAAA,WACf,IAAIwC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAE7BtC,MAAAA,EAAE,CAACuC,MAAH,GAAY;AAAA,eAAMF,OAAO,CAACrC,EAAD,CAAb;AAAA,OAAZ;;AACAA,MAAAA,EAAE,CAACwC,OAAH,GAAaF,MAAb;AAEAtC,MAAAA,EAAE,CAAC2B,IAAH,GAAUnB,GAAV;AAEAR,MAAAA,EAAE,CAACkD,KAAH,GAAW,CAAX;AACAlD,MAAAA,EAAE,CAACmD,MAAH,GAAY,CAAZ;AAEAxD,MAAAA,QAAQ,CAACyD,IAAT,CAAcC,MAAd,CAAqBrD,EAArB;AACH,KAXD,CADe;AAAA,GAAnB;;AAcA,MAAMsD,UAAU,GAAG,SAAbA,UAAa,CAAC9C,GAAD;AAAA,QAAMR,EAAN,uEAAWL,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAX;AAAA,WACf,IAAIwC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAE7BtC,MAAAA,EAAE,CAACuC,MAAH,GAAY;AAAA,eAAMF,OAAO,CAACrC,EAAD,CAAb;AAAA,OAAZ;;AACAA,MAAAA,EAAE,CAACwC,OAAH,GAAaF,MAAb;AAEAtC,MAAAA,EAAE,CAACyC,GAAH,GAASjC,GAAT;AACAR,MAAAA,EAAE,CAACuD,KAAH,GAAW,IAAX;AAEA5D,MAAAA,QAAQ,CAAC6D,IAAT,CAAcH,MAAd,CAAqBrD,EAArB;AACH,KATD,CADe;AAAA,GAAnB;;AAYA,MAAIyD,OAAO,GAAG;AACVC,IAAAA,KAAK,EAAE,eAAClD,GAAD,EAAMmD,IAAN,EAAY3D,EAAZ;AAAA,aAAmBkC,SAAS,CAAC1B,GAAD,EAAMmD,IAAI,GAAG3D,EAAH,GAAQ,KAAK,CAAvB,CAA5B;AAAA,KADG;AAEV4D,IAAAA,KAAK,EAAE,eAACpD,GAAD,EAAMmD,IAAN,EAAY3D,EAAZ;AAAA,aAAmB0C,SAAS,CAAClC,GAAD,EAAMmD,IAAI,GAAG3D,EAAH,GAAQ,KAAK,CAAvB,CAA5B;AAAA,KAFG;AAGV6D,IAAAA,MAAM,EAAE,gBAACrD,GAAD,EAAMmD,IAAN;AAAA,aAAgBA,IAAI,GAAGL,UAAU,CAAC9C,GAAD,CAAb,GAAqByC,UAAU,CAACzC,GAAD,CAAnD;AAAA,KAHE;AAIVsD,IAAAA,KAAK,EAAE,eAACtD,GAAD,EAAMmD,IAAN;AAAA,aAAehB,SAAS,CAACnC,GAAD,EAAMmD,IAAI,GAAGhE,QAAH,GAAc,KAAK,CAA7B,CAAxB;AAAA;AAJG,GAAd;;AAOA,MAAMY,IAAI,GAAG,SAAPA,IAAO,GAAM;AACfwD,IAAAA,SAAS;AAAA,2DAAG,iBAAMC,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AACFrC,gBAAAA,IADE,GACKqC,KAAK,CAACrC,IADX;AAAA;AAAA;AAAA,uBAMmBsC,KAAK,CAACtC,IAAI,CAAC9B,IAAN,EAAY8B,IAAI,CAACuC,OAAjB,CANxB;;AAAA;AAMEC,gBAAAA,QANF;AAAA;AAAA,uBAOeA,QAAQ,CAACvC,IAAT,EAPf;;AAAA;AAOEA,gBAAAA,IAPF;AASJwC,gBAAAA,OAAO,GAAG;AACNC,kBAAAA,MAAM,EAAEF,QAAQ,CAACE,MADX;AAENC,kBAAAA,UAAU,EAAEH,QAAQ,CAACG,UAFf;AAGN1C,kBAAAA,IAAI,EAAEA;AAHA,iBAAV;AATI;AAAA;;AAAA;AAAA;AAAA;AAeJwC,gBAAAA,OAAO,GAAG;AACNC,kBAAAA,MAAM,EAAE,CADF;AAENC,kBAAAA,UAAU;AAFJ,iBAAV;;AAfI;AAsBRF,gBAAAA,OAAO,CAACvE,IAAR,GAAe8B,IAAI,CAAC9B,IAApB;AACA0E,gBAAAA,WAAW,CAACH,OAAD,CAAX;;AAvBQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAH;;AAAA;AAAA;AAAA;AAAA,OAAT;AAyBH,GA1BD;;AA4BA,MAAIvD,MAAM,GAAG,IAAb;;AACA,MAAI2D,YAAY,GAAG,SAAfA,YAAe,GAAM;AAErB,QAAI3D,MAAJ,EAAY;AACR,aAAOA,MAAP;AACH;;AAGD,WAAQA,MAAM,GAAGP,YAAY,CAACC,IAAD,CAA7B;AACH,GARD;;AAWA,MAAMkE,YAAY,GAAG,EAArB;;AAOA,MAAIC,MAAM;AAAA,0DAAG,kBAAOC,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAiBT,cAAAA,OAAjB,8DAA2B,EAA3B;;AAAA,oBAELS,QAAQ,CAACnE,GAAT,CAAaX,IAAb,IAAqB4E,YAFhB;AAAA;AAAA;AAAA;;AAAA,gDAGE,IAAIrC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpCmC,gBAAAA,YAAY,CAACE,QAAQ,CAACnE,GAAT,CAAaX,IAAd,CAAZ,CACK+E,IADL,CACU,UAAAC,CAAC;AAAA,yBACHxC,OAAO,CACH,IAAIR,cAAJ,CACI;AACI7B,oBAAAA,EAAE,EAAE2E,QAAQ,CAAC3E,EADjB;AAEI4B,oBAAAA,IAAI,EAAEiD,CAAC,CAACjD,IAFZ;AAGIpB,oBAAAA,GAAG,EAAEqE,CAAC,CAACrE;AAHX,mBADJ,EAMI,IANJ,CADG,CADJ;AAAA,iBADX,WAaW8B,MAbX;AAcH,eAfM,CAHF;;AAAA;AAAA,oBAsBLnB,MAAM,CAACwD,QAAD,CAAN,IAAoBT,OAAO,CAACD,KAAR,CAAca,IAAd,KAAuB,SAtBtC;AAAA;AAAA;AAAA;;AAAA,gDAuBGL,YAAY,CAACE,QAAQ,CAACnE,GAAT,CAAaX,IAAd,CAAZ,GAAkCkF,KAAK,CAC3CJ,QAD2C,EAE3CT,OAF2C,EAG3C,KAH2C,CAvB1C;;AAAA;AAAA,gDA+BDO,YAAY,CAACE,QAAQ,CAACnE,GAAT,CAAaX,IAAd,CAAZ,GAAkC,IAAIuC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACvE,oBAAMzB,MAAM,GAAG2D,YAAY,EAA3B;AAGA3D,gBAAAA,MAAM,CAAC0D,WAAP,CAAmB;AACf1E,kBAAAA,IAAI,EAAE8E,QAAQ,CAACnE,GAAT,CAAaX,IADJ;AAEfqE,kBAAAA,OAAO,EAAEA,OAAO,CAACD;AAFF,iBAAnB;AAMApD,gBAAAA,MAAM,CAACmE,gBAAP,CAAwB,SAAxB,EAAmC,UAAAhB,KAAK,EAAI;AACxC,sBAAMrC,IAAI,GAAGqC,KAAK,CAACrC,IAAnB;;AAGA,sBAAIA,IAAI,CAAC9B,IAAL,KAAc8E,QAAQ,CAACnE,GAAT,CAAaX,IAA/B,EAAqC;AACjC;AACH;;AAGD,sBAAI8B,IAAI,CAAC0C,MAAL,KAAgB,GAApB,EAAyB;AACrBhC,oBAAAA,OAAO,CACH,IAAIR,cAAJ,mBAEW8C,QAFX,MAGW;AACC/C,sBAAAA,IAAI,EAAED,IAAI,CAACC;AADZ,qBAHX,GAOI,IAPJ,CADG,CAAP;AAYA;AACH;;AAGDU,kBAAAA,MAAM,CAAC,IAAI2C,KAAJ,WAAatD,IAAI,CAAC2C,UAAlB,cAAgC3C,IAAI,CAAC9B,IAArC,EAAD,CAAN;AACH,iBA3BD;AA4BH,eAtCyC,CA/BjC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAN6E,MAAM;AAAA;AAAA;AAAA,KAAV;;AA6EA,MAAIK,KAAK;AAAA,0DAAG,kBAAOJ,QAAP,EAAiBT,OAAjB,EAA0BP,IAA1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAEJ,CAACxC,MAAM,CAACwD,QAAD,CAAP,IAAqBT,OAAO,CAACD,KAAR,CAAca,IAAd,KAAuB,SAFxC;AAAA;AAAA;AAAA;;AAAA;AAIM9E,cAAAA,EAJN,GAIW2E,QAAQ,CAAC3E,EAJpB;AAAA;AAAA,qBAKiB0E,MAAM,CAACC,QAAD,EAAWT,OAAX,CALvB;;AAAA;AAKAS,cAAAA,QALA;AAMAA,cAAAA,QAAQ,CAAC3E,EAAT,GAAcA,EAAd;AANA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAWFY,cAAAA,IAXE,GAWKI,aAAa,CAAC2D,QAAD,CAXlB;;AAAA,kBAYF/D,IAAI,IAAI6C,OAZN;AAAA;AAAA;AAAA;;AAAA,gDAaGrB,OAAO,CAACE,MAAR,CAAe,IAAI2C,KAAJ,CAAU,cAAV,CAAf,CAbH;;AAAA;AAiBFzE,cAAAA,GAjBE,GAiBI,CAAC,CAACmE,QAAQ,CAAC/C,IAAX,GACN9B,GAAG,CAACW,eAAJ,CAAoBkE,QAAQ,CAAC/C,IAA7B,CADM,GAEN+C,QAAQ,CAACnE,GAAT,CAAaX,IAnBX;AAAA,gDAsBD,IAAIuC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV;AAAA,uBACfmB,OAAO,CAAC7C,IAAD,CAAP,CAAcJ,GAAd,EAAmBmD,IAAnB,EAAyBgB,QAAQ,CAAC3E,EAAlC,aACa;AAAA,yBAAMF,GAAG,CAACiB,eAAJ,CAAoBP,GAApB,CAAN;AAAA,iBADb,EAEKoE,IAFL,CAEU;AAAA,yBAAMvC,OAAO,CAACsC,QAAD,CAAb;AAAA,iBAFV,WAGWrC,MAHX,CADe;AAAA,eAAZ,CAtBC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAALyC,KAAK;AAAA;AAAA;AAAA,KAAT;;AApWiB,MAkYX/F,MAlYW;AAmYb,oBAAYkF,OAAZ,EAAqB;AAAA;;AACjB,WAAKA,OAAL,qBACO;AACCD,QAAAA,KAAK,EAAE;AAGHa,UAAAA,IAAI,EAAE;AAHH;AADR,OADP,MAQOZ,OARP;AAUH;;AA9YY;AAAA;AAAA,4BAqZPzE,GArZO,EAqZF;AAAA;;AAEP,YAAIA,GAAG,YAAYyF,QAAnB,EAA6B;AACzB,iBAAO,KAAKjB,KAAL,oBAAexE,GAAf,EAAP;AACH;;AAGD,YAAI0F,KAAK,CAACC,OAAN,CAAc3F,GAAd,CAAJ,EAAwB;AACpB,iBAAOA,GAAG,CAAC4F,GAAJ,CAAQ,UAAA3F,CAAC;AAAA,mBAAI,KAAI,CAACuE,KAAL,CAAWvE,CAAX,CAAJ;AAAA,WAAT,CAAP;AACH;;AAGD,YAAI,OAAOD,GAAP,KAAe,QAAnB,EAA6B;AACzB,iBAAO,KAAKwE,KAAL,CAAWzE,MAAM,CAACC,GAAD,CAAjB,CAAP;AACH;;AAGD,YAAIM,kBAAkB,CAACN,GAAD,CAAlB,IAA2BA,GAAG,YAAYK,GAA9C,EAAmD;AAC/C,iBAAO,KAAKmE,KAAL,CAAW,IAAIpC,cAAJ,CAAmBpC,GAAnB,CAAX,CAAP;AACH;;AAGD,YAAIoC,cAAc,CAACyD,gBAAf,CAAgC7F,GAAhC,CAAJ,EAA0C;AACtC,iBAAOiF,MAAM,CAACjF,GAAD,EAAM,KAAKyE,OAAX,CAAb;AACH;;AAGD,eAAO9B,OAAO,CAACE,MAAR,CAAe,IAAI2C,KAAJ,CAAU,kBAAV,CAAf,CAAP;AACH;AAjbY;AAAA;AAAA,2BAubRxF,GAvbQ,EAubH;AAAA;;AACN,YAAIA,GAAG,YAAYyF,QAAnB,EAA6B;AACzB,iBAAO,KAAKK,IAAL,oBAAc9F,GAAd,EAAP;AACH;;AAGD,YAAI0F,KAAK,CAACC,OAAN,CAAc3F,GAAd,CAAJ,EAAwB;AACpB,iBAAOA,GAAG,CAAC4F,GAAJ,CAAQ,UAAA3F,CAAC;AAAA,mBAAI,MAAI,CAAC6F,IAAL,CAAU7F,CAAV,CAAJ;AAAA,WAAT,CAAP;AACH;;AAGD,YAAI,OAAOD,GAAP,KAAe,QAAnB,EAA6B;AACzB,iBAAO,KAAK8F,IAAL,CAAU/F,MAAM,CAACC,GAAD,CAAhB,CAAP;AACH;;AAGD,YAAIM,kBAAkB,CAACN,GAAD,CAAlB,IAA2BA,GAAG,YAAYK,GAA9C,EAAmD;AAC/C,iBAAO,KAAKyF,IAAL,CAAU,IAAI1D,cAAJ,CAAmBpC,GAAnB,CAAV,CAAP;AACH;;AAGD,YAAIoC,cAAc,CAACyD,gBAAf,CAAgC7F,GAAhC,CAAJ,EAA0C;AACtC,iBAAOsF,KAAK,CAACtF,GAAD,EAAM,KAAKyE,OAAX,EAAoB,IAApB,CAAZ;AACH;;AAGD,eAAO9B,OAAO,CAACE,MAAR,CAAe,IAAI2C,KAAJ,CAAU,kBAAV,CAAf,CAAP;AACH;AAldY;;AAAA;AAAA;;AAqdjB,SAAOjG,MAAP;AAEH,CA3dA,CAAD","file":"loader.es5.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Loader', factory) :\n    (global = global || self, global.Loader = factory());\n}(this, (function () { 'use strict';\n\n    /**\n     *\n     * @param {Object} o\n     * @param {String} p\n     */\n    const prop = (o, p) =>\n        p.split(\".\").reduce((xs, x) => (xs && xs[x] ? xs[x] : null), o);\n\n    /**\n     *\n     * @param {String|LoaderResource} url\n     * @returns {URL}\n     */\n    const getURL = arg => {\n        arg = prop(arg, \"url\") || arg;\n        arg = prop(arg, \"href\") || arg;\n\n        const a = document.createElement(\"a\");\n        a.href = arg;\n\n        return new URL(a);\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @returns {Boolean}\n     */\n    const isSupportedElement = el => {\n        return (\n            el instanceof HTMLImageElement ||\n            el instanceof HTMLPictureElement ||\n            el instanceof HTMLSourceElement ||\n            el instanceof HTMLVideoElement ||\n            el instanceof HTMLAudioElement\n        );\n    };\n\n    /**\n     *\n     * @param {Function} work\n     * @returns {Worker}\n     */\n    const createWorker = work => {\n        work = typeof work !== \"function\" ? () => {} : work;\n\n        const url = URL.createObjectURL(\n            new Blob([\"(\", work.toString(), \")()\"], {\n                type: \"application/javascript\"\n            })\n        );\n\n        const worker = new Worker(url);\n\n        URL.revokeObjectURL(url);\n\n        return worker;\n    };\n\n    /**\n     * TODO: check\n     * @param {String|LoaderResource} arg\n     */\n    const getLoaderType = arg => {\n        arg = getURL(arg).href;\n\n        let ext = arg.split(\".\");\n        ext = ext[ext.length - 1];\n\n        switch (ext) {\n            case \"jpg\":\n            case \"jpe\":\n            case \"jpeg\":\n            case \"jif\":\n            case \"jfi\":\n            case \"jfif\":\n            case \"gif\":\n            case \"tif\":\n            case \"tiff\":\n            case \"bmp\":\n            case \"dib\":\n            case \"webp\":\n            case \"ico\":\n            case \"cur\":\n            case \"svg\":\n            case \"png\":\n                return \"image\";\n            case \"css\":\n                return \"style\";\n            case \"js\":\n            case \"mjs\":\n                return \"script\";\n            case \"mp3\":\n            case \"ogg\":\n            case \"oga\":\n            case \"spx\":\n            case \"ogg\":\n            case \"wav\":\n            case \"mp4\":\n            case \"ogg\":\n            case \"ogv\":\n            case \"webm\":\n                return \"media\";\n            default:\n                return \"noop\";\n        }\n    };\n\n    /**\n     *\n     * @param {URL|String|LoaderResource} arg\n     * @returns {Boolean}\n     */\n    const isCORS = arg => {\n        arg = getURL(arg);\n\n        return (\n            arg.hostname !== window.location.hostname ||\n            arg.protocol !== window.location.protocol\n        );\n    };\n\n    // ...\n    const collection = new WeakMap();\n\n    // ...\n    const build = data => {\n        let o = {};\n\n        if (isSupportedElement(data)) {\n            o.el = data;\n            o.url = getURL(prop(o.el, \"dataset.src\")); // TODO: find a way to get currentSrc without triggering load\n        } else {\n            o.el = prop(data, \"el\");\n            o.url = data instanceof URL ? data : prop(data, \"url\");\n        }\n\n        o.blob = prop(data, \"blob\");\n\n        return o;\n    };\n\n    // ...\n    // TODO: refactor to avoid \"override\" param\n    class LoaderResource {\n        constructor(data, override) {\n            let o = build(data);\n\n            if (collection.has(o.url) && !override) {\n                o = collection.get(o.url);\n            }\n\n            if (collection.has(o.el) && !override) {\n                o = collection.get(o.el);\n            }\n\n            this.el = o.el;\n            this.url = o.url;\n            this.blob = o.blob;\n\n            collection.set(o.el || o.url, this);\n        }\n\n        static isLoaderResource(data) {\n            return data instanceof this;\n        }\n    }\n\n    const loadImage = (url, el = new Image()) =>\n        new Promise((resolve, reject) => {\n            el.onload = () => resolve(el);\n            el.onerror = reject;\n\n            el.src = url;\n        });\n\n    const loadMedia = (url, el = new Image()) =>\n        // TODO:\n        new Promise((resolve, reject) => {\n            el.onload = () => resolve(el);\n            el.onerror = reject;\n\n            el.src = url;\n        });\n\n    const loadStyle = (url, el = document.createElement(\"div\")) => {\n        const sheet = new CSSStyleSheet();\n\n        const promise = sheet.replace(`@import url(\"${url}\")`);\n\n        if (\"adoptedStyleSheets\" in el) {\n            el.adoptedStyleSheets = [...el.adoptedStyleSheets, sheet];\n        }\n\n        return promise;\n    };\n\n    const loadObject = (url, el = document.createElement(\"object\")) =>\n        new Promise((resolve, reject) => {\n            // TODO: check\n            el.onload = () => resolve(el);\n            el.onerror = reject;\n\n            el.data = url;\n\n            el.width = 0;\n            el.height = 0;\n\n            document.body.append(el);\n        });\n\n    const loadScript = (url, el = document.createElement(\"script\")) =>\n        new Promise((resolve, reject) => {\n            // TODO: check\n            el.onload = () => resolve(el);\n            el.onerror = reject;\n\n            el.src = url;\n            el.async = true;\n\n            document.head.append(el);\n        });\n\n    var Loaders = {\n        image: (url, bool, el) => loadImage(url, bool ? el : void 0),\n        media: (url, bool, el) => loadMedia(url, bool ? el : void 0),\n        script: (url, bool) => (bool ? loadScript(url) : loadObject(url)),\n        style: (url, bool) => loadStyle(url, bool ? document : void 0)\n    };\n\n    const work = () => {\n        onmessage = async event => {\n            const data = event.data;\n\n            // ...\n            let message;\n            try {\n                const response = await fetch(data.href, data.options);\n                const blob = await response.blob();\n\n                message = {\n                    status: response.status,\n                    statusText: response.statusText,\n                    blob: blob\n                };\n            } catch (e) {\n                message = {\n                    status: 0,\n                    statusText: e\n                };\n            }\n\n            // ...\n            message.href = data.href;\n            postMessage(message);\n        };\n    };\n\n    let worker = null;\n    var loaderWorker = () => {\n        // ...\n        if (worker) {\n            return worker;\n        }\n\n        // ...\n        return (worker = createWorker(work));\n    };\n\n    // ...\n    const collection$1 = {};\n\n    /**\n     *\n     * @param {LoaderResource} resource\n     * @param {Object} options\n     */\n    var _fetch = async (resource, options = {}) => {\n        // ...\n        if (resource.url.href in collection$1) {\n            return new Promise((resolve, reject) => {\n                collection$1[resource.url.href]\n                    .then(r =>\n                        resolve(\n                            new LoaderResource(\n                                {\n                                    el: resource.el,\n                                    blob: r.blob,\n                                    url: r.url\n                                },\n                                true\n                            )\n                        )\n                    )\n                    .catch(reject);\n            });\n        }\n\n        // ...\n        if (isCORS(resource) && options.fetch.cors !== \"no-cors\") {\n            return (collection$1[resource.url.href] = _load(\n                resource,\n                options,\n                false\n            ));\n        }\n\n        // ...\n        return (collection$1[resource.url.href] = new Promise((resolve, reject) => {\n            const worker = loaderWorker();\n\n            // ...\n            worker.postMessage({\n                href: resource.url.href,\n                options: options.fetch\n            });\n\n            // ...\n            worker.addEventListener(\"message\", event => {\n                const data = event.data;\n\n                // ...\n                if (data.href !== resource.url.href) {\n                    return;\n                }\n\n                // ...\n                if (data.status === 200) {\n                    resolve(\n                        new LoaderResource(\n                            {\n                                ...resource,\n                                ...{\n                                    blob: data.blob\n                                }\n                            },\n                            true\n                        )\n                    );\n\n                    return;\n                }\n\n                // ...\n                reject(new Error(`${data.statusText} ${data.href}`));\n            });\n        }));\n    };\n\n    /**\n     *\n     * @param {LoaderResource} resource\n     * @param {Object} options\n     */\n    var _load = async (resource, options, bool) => {\n        // ...\n        if (!isCORS(resource) || options.fetch.cors === \"no-cors\") {\n            try {\n                const el = resource.el;\n                resource = await _fetch(resource, options);\n                resource.el = el;\n            } catch (e) {}\n        }\n\n        // ...\n        const type = getLoaderType(resource);\n        if (!(type in Loaders)) {\n            return Promise.reject(new Error(\"invalid type\"));\n        }\n\n        // ...\n        const url = !!resource.blob\n            ? URL.createObjectURL(resource.blob)\n            : resource.url.href;\n\n        // ...\n        return new Promise((resolve, reject) =>\n            Loaders[type](url, bool, resource.el)\n                .finally(() => URL.revokeObjectURL(url))\n                .then(() => resolve(resource))\n                .catch(reject)\n        );\n    };\n\n    class Loader {\n        constructor(options) {\n            this.options = {\n                ...{\n                    fetch: {\n                        // this way fetch throws but you don't get double download\n                        // TODO: check if opt makes sense\n                        cors: \"no-cors\"\n                    }\n                },\n                ...options\n            };\n        }\n\n        /**\n         *\n         * @param {String|Array|LoaderResource|HTMLElement|NodeList} arg\n         * @returns {Array|Promise}\n         */\n        fetch(arg) {\n            // ...\n            if (arg instanceof NodeList) {\n                return this.fetch([...arg]);\n            }\n\n            // ...\n            if (Array.isArray(arg)) {\n                return arg.map(a => this.fetch(a));\n            }\n\n            // ...\n            if (typeof arg === \"string\") {\n                return this.fetch(getURL(arg));\n            }\n\n            // ...\n            if (isSupportedElement(arg) || arg instanceof URL) {\n                return this.fetch(new LoaderResource(arg));\n            }\n\n            // ...\n            if (LoaderResource.isLoaderResource(arg)) {\n                return _fetch(arg, this.options);\n            }\n\n            // ...\n            return Promise.reject(new Error(\"invalid argument\"));\n        }\n\n        /**\n         * @param {String|Array|LoaderResource|HTMLElement|NodeList|URL} arg\n         * @returns {Array|Promise}\n         */\n        load(arg) {\n            if (arg instanceof NodeList) {\n                return this.load([...arg]);\n            }\n\n            // ...\n            if (Array.isArray(arg)) {\n                return arg.map(a => this.load(a));\n            }\n\n            // ...\n            if (typeof arg === \"string\") {\n                return this.load(getURL(arg));\n            }\n\n            // ...\n            if (isSupportedElement(arg) || arg instanceof URL) {\n                return this.load(new LoaderResource(arg));\n            }\n\n            // ...\n            if (LoaderResource.isLoaderResource(arg)) {\n                return _load(arg, this.options, true);\n            }\n\n            // ...\n            return Promise.reject(new Error(\"invalid argument\"));\n        }\n    }\n\n    return Loader;\n\n})));\n"]}