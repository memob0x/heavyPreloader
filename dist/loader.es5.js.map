{"version":3,"sources":["loader.mjs"],"names":["global","factory","exports","module","define","amd","self","Loader","parseUrl","url","a","document","createElement","href","urlFromDataObject","data","blob","type","URL","createObjectURL","response","getLoaderTypeFromUrl","isCORSUrl","host","window","location","image","attributeName","el","Image","Promise","resolve","reject","onload","onerror","setAttribute","style","sheet","CSSStyleSheet","promise","replace","adoptedStyleSheets","object","preload","i","width","height","body","append","script","tagName","src","async","head","Loaders","Object","freeze","__proto__","worker","onmessage","event","fetch","status","statusText","postMessage","options","Worker","Blob","toString","_options","parsedUrl","defaultData","then","addEventListener","Error","e","revokeObjectURL","name","loader","querySelectorAll","forEach","dataset","x","setImageAttribute","console","error","adoptStyleSheet","insertScript","defineProperty","value"],"mappings":"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","file":"loader.es5.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define('Loader', ['exports'], factory) :\n    (global = global || self, factory(global.Loader = {}));\n}(this, (function (exports) { 'use strict';\n\n    /**\n     *\n     * @param url\n     */\n    const parseUrl = url => {\n        const a = document.createElement(\"a\");\n        a.href = url;\n        return a;\n    };\n\n    /**\n     *\n     * @param data\n     */\n    const urlFromDataObject = data =>\n        data.blob.type ? URL.createObjectURL(data.blob) : data.response.url;\n\n    /**\n     * TODO: do it\n     * @param url\n     */\n    const getLoaderTypeFromUrl = url => \"image\";\n\n    /**\n     *\n     * @param url\n     */\n    const isCORSUrl = url => url.host !== window.location.host;\n\n    const image = (url, attributeName = \"src\", el = new Image()) =>\n        new Promise((resolve, reject) => {\n            el.onload = resolve;\n            el.onerror = reject;\n\n            el.setAttribute(attributeName, url);\n        });\n\n    const style = (url, el = document.createElement(\"div\")) => {\n        const sheet = new CSSStyleSheet();\n\n        const promise = sheet.replace(`@import url(\"${url}\")`);\n\n        if (\"adoptedStyleSheets\" in el) {\n            el.adoptedStyleSheets = [...el.adoptedStyleSheets, sheet];\n        }\n\n        return promise;\n    };\n\n    const object = (url, el) =>\n        new Promise((resolve, reject) => {\n            el.onload = resolve;\n            el.onerror = reject;\n\n            el.data = preload[i];\n\n            el.width = 0;\n            el.height = 0;\n\n            document.body.append(el);\n        });\n\n    const script = (url, el = document.createElement(\"object\")) =>\n        el.tagName === \"OBJECT\"\n            ? object(url, el)\n            : new Promise((resolve, reject) => {\n                  el.onload = resolve;\n                  el.onerror = reject;\n\n                  el.src = url;\n                  el.async = true;\n\n                  document.head.append(el);\n              });\n\n    var Loaders = /*#__PURE__*/Object.freeze({\n        __proto__: null,\n        image: image,\n        style: style,\n        script: script\n    });\n\n    var worker = () => {\n        onmessage = async event => {\n            let data = event.data;\n\n            try {\n                const response = await fetch(data.url);\n                const blob = await response.blob();\n\n                data.response = {\n                    url: response.url,\n                    status: response.status,\n                    statusText: response.statusText\n                };\n\n                data.blob = blob;\n            } catch (e) {\n                data.response = {\n                    url: data.url,\n                    status: 200\n                };\n\n                data.blob = { type: null };\n            }\n\n            postMessage(data);\n        };\n    };\n\n    class Loader {\n        /**\n         *\n         * @param {object} options\n         */\n        constructor(options = {}) {\n            this.worker = new Worker(\n                URL.createObjectURL(\n                    new Blob([\"(\", worker.toString(), \")()\"], {\n                        type: \"application/javascript\"\n                    })\n                )\n            );\n\n            this._options = { ...options, ...{} };\n        }\n\n        /**\n         * @param {string} url\n         * @returns {Promise}\n         */\n        fetch(url) {\n            const parsedUrl = parseUrl(url);\n\n            url = parsedUrl.href;\n\n            return new Promise((resolve, reject) => {\n                try {\n                    if (isCORSUrl(parsedUrl)) {\n                        const type = getLoaderTypeFromUrl(url);\n\n                        const defaultData = {\n                            response: {\n                                url: url,\n                                status: 200\n                            },\n                            blob: {\n                                type: null\n                            }\n                        };\n\n                        if (type in Loaders) {\n                            return Loaders[type](url)\n                                .then(() => resolve(defaultData))\n                                .catch(reject);\n                        }\n\n                        resolve(defaultData);\n\n                        return;\n                    }\n\n                    this.worker.postMessage({\n                        url: url\n                    });\n\n                    this.worker.addEventListener(\"message\", event => {\n                        const data = event.data;\n\n                        if (data.url !== url) {\n                            return;\n                        }\n\n                        if (data.response.status !== 200) {\n                            reject(\n                                new Error(\n                                    `${data.response.statusText} ${data.response.url}`\n                                )\n                            );\n\n                            return;\n                        }\n\n                        resolve(data);\n                    });\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        }\n\n        /**\n         *\n         * @param data\n         * @param el\n         */\n        static adoptStyleSheet(data) {\n            const url = urlFromDataObject(data);\n\n            return style(url, document).finally(() =>\n                URL.revokeObjectURL(url)\n            );\n        }\n\n        /**\n         *\n         * @param data\n         */\n        static insertScript(data) {\n            const url = urlFromDataObject(data);\n\n            return script(\n                url,\n                document.createElement(\"script\")\n            ).finally(() => URL.revokeObjectURL(url));\n        }\n\n        /**\n         *\n         * @param data\n         * @param el\n         * @param name\n         */\n        static setImageAttribute(data, el, name = \"src\") {\n            const url = urlFromDataObject(data);\n\n            return image(url, name, el).finally(() =>\n                URL.revokeObjectURL(url)\n            );\n        }\n    }\n\n    const loader = new Loader();\n\n    [...document.querySelectorAll(\"img[data-src]\")].forEach(el =>\n        loader\n            .fetch(el.dataset.src)\n            .then(x => Loader.setImageAttribute(x, el))\n            .catch(e => console.error(e))\n    );\n\n    loader\n        .fetch(\"dist/styles.css\")\n        .then(x => Loader.adoptStyleSheet(x))\n        .catch(e => console.error(e));\n\n    loader\n        .fetch(\"dist/extra.css\")\n        .then(x => Loader.adoptStyleSheet(x))\n        .catch(e => console.error(e));\n\n    loader\n        .fetch(\"dist/scripts.js\")\n        .then(x => Loader.insertScript(x))\n        .catch(e => console.error(e));\n\n    loader\n        .fetch(\"dist/not-existent.js\")\n        .then(x => Loader.insertScript(x))\n        .catch(e => console.error(e));\n\n    exports.Loader = Loader;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n})));\n"]}