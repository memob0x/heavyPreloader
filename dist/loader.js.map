{"version":3,"file":"loader.js","sources":["src/loader.utils.mjs","src/loader.loaders.mjs","src/loader.worker.mjs","src/loader.mjs"],"sourcesContent":["/**\n *\n * @param url\n */\nexport const parseUrl = url => {\n    const a = document.createElement(\"a\");\n    a.href = url;\n    return a;\n};\n\n/**\n *\n * @param data\n */\nexport const urlFromDataObject = data =>\n    data.blob.type ? URL.createObjectURL(data.blob) : data.response.url;\n\n/**\n * TODO: do it\n * @param url\n */\nexport const getLoaderTypeFromUrl = url => \"image\";\n\n/**\n *\n * @param url\n */\nexport const isCORSUrl = url => url.host !== window.location.host;\n","export const image = (url, attributeName = \"src\", el = new Image()) =>\n    new Promise((resolve, reject) => {\n        el.onload = resolve;\n        el.onerror = reject;\n\n        el.setAttribute(attributeName, url);\n    });\n\nexport const style = (url, el = document.createElement(\"div\")) => {\n    const sheet = new CSSStyleSheet();\n\n    const promise = sheet.replace(`@import url(\"${url}\")`);\n\n    if (\"adoptedStyleSheets\" in el) {\n        el.adoptedStyleSheets = [...el.adoptedStyleSheets, sheet];\n    }\n\n    return promise;\n};\n\nconst object = (url, el) =>\n    new Promise((resolve, reject) => {\n        el.onload = resolve;\n        el.onerror = reject;\n\n        el.data = preload[i];\n\n        el.width = 0;\n        el.height = 0;\n\n        document.body.append(el);\n    });\n\nexport const script = (url, el = document.createElement(\"object\")) =>\n    el.tagName === \"OBJECT\"\n        ? object(url, el)\n        : new Promise((resolve, reject) => {\n              el.onload = resolve;\n              el.onerror = reject;\n\n              el.src = url;\n              el.async = true;\n\n              document.head.append(el);\n          });\n","export default () => {\n    onmessage = async event => {\n        let data = event.data;\n\n        try {\n            const response = await fetch(data.url);\n            const blob = await response.blob();\n\n            data.response = {\n                url: response.url,\n                status: response.status,\n                statusText: response.statusText\n            };\n\n            data.blob = blob;\n        } catch (e) {\n            data.response = {\n                url: data.url,\n                status: 200\n            };\n\n            data.blob = { type: null };\n        }\n\n        postMessage(data);\n    };\n};\n","import {\n    parseUrl,\n    urlFromDataObject,\n    getLoaderTypeFromUrl,\n    isCORSUrl\n} from \"./loader.utils.mjs\";\nimport * as Loaders from \"./loader.loaders.mjs\";\nimport worker from \"./loader.worker.mjs\";\n\nexport class Loader {\n    /**\n     *\n     * @param {object} options\n     */\n    constructor(options = {}) {\n        this.worker = new Worker(\n            URL.createObjectURL(\n                new Blob([\"(\", worker.toString(), \")()\"], {\n                    type: \"application/javascript\"\n                })\n            )\n        );\n\n        this._options = { ...options, ...{} };\n    }\n\n    /**\n     * @param {string} url\n     * @returns {Promise}\n     */\n    fetch(url) {\n        const parsedUrl = parseUrl(url);\n\n        url = parsedUrl.href;\n\n        return new Promise((resolve, reject) => {\n            try {\n                if (isCORSUrl(parsedUrl)) {\n                    const type = getLoaderTypeFromUrl(url);\n\n                    const defaultData = {\n                        response: {\n                            url: url,\n                            status: 200\n                        },\n                        blob: {\n                            type: null\n                        }\n                    };\n\n                    if (type in Loaders) {\n                        return Loaders[type](url)\n                            .then(() => resolve(defaultData))\n                            .catch(reject);\n                    }\n\n                    resolve(defaultData);\n\n                    return;\n                }\n\n                this.worker.postMessage({\n                    url: url\n                });\n\n                this.worker.addEventListener(\"message\", event => {\n                    const data = event.data;\n\n                    if (data.url !== url) {\n                        return;\n                    }\n\n                    if (data.response.status !== 200) {\n                        reject(\n                            new Error(\n                                `${data.response.statusText} ${data.response.url}`\n                            )\n                        );\n\n                        return;\n                    }\n\n                    resolve(data);\n                });\n            } catch (e) {\n                reject(e);\n            }\n        });\n    }\n\n    /**\n     *\n     * @param data\n     * @param el\n     */\n    static adoptStyleSheet(data) {\n        const url = urlFromDataObject(data);\n\n        return Loaders.style(url, document).finally(() =>\n            URL.revokeObjectURL(url)\n        );\n    }\n\n    /**\n     *\n     * @param data\n     */\n    static insertScript(data) {\n        const url = urlFromDataObject(data);\n\n        return Loaders.script(\n            url,\n            document.createElement(\"script\")\n        ).finally(() => URL.revokeObjectURL(url));\n    }\n\n    /**\n     *\n     * @param data\n     * @param el\n     * @param name\n     */\n    static setImageAttribute(data, el, name = \"src\") {\n        const url = urlFromDataObject(data);\n\n        return Loaders.image(url, name, el).finally(() =>\n            URL.revokeObjectURL(url)\n        );\n    }\n}\n\nconst loader = new Loader();\n\n[...document.querySelectorAll(\"img[data-src]\")].forEach(el =>\n    loader\n        .fetch(el.dataset.src)\n        .then(x => Loader.setImageAttribute(x, el))\n        .catch(e => console.error(e))\n);\n\nloader\n    .fetch(\"dist/styles.css\")\n    .then(x => Loader.adoptStyleSheet(x))\n    .catch(e => console.error(e));\n\nloader\n    .fetch(\"dist/extra.css\")\n    .then(x => Loader.adoptStyleSheet(x))\n    .catch(e => console.error(e));\n\nloader\n    .fetch(\"dist/scripts.js\")\n    .then(x => Loader.insertScript(x))\n    .catch(e => console.error(e));\n\nloader\n    .fetch(\"dist/not-existent.js\")\n    .then(x => Loader.insertScript(x))\n    .catch(e => console.error(e));\n"],"names":["Loaders.style","Loaders.script","Loaders.image"],"mappings":"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"}