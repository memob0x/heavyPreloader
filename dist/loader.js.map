{"version":3,"file":"loader.js","sources":["src/loader.utils.mjs","src/loader.worker.mjs","src/loader.fetch.mjs","src/loader.mjs"],"sourcesContent":["/**\n *\n * @private\n * @static\n * @param {String} href\n * @returns {URL}\n */\nexport const getURL = (href) =>\n    new URL(\n        ((a) => {\n            a.href = href;\n\n            return a;\n        })(document.createElement(\"a\"))\n    );\n\n/**\n *\n * @private\n * @static\n * @param {Function} work\n * @returns {Worker}\n */\nexport const createWorker = (work) => {\n    if (typeof work !== \"function\") {\n        throw new TypeError(\n            `Invalid argment of type ${typeof work} passed to Loader class internal \"createWorker\" function.`\n        );\n    }\n\n    const url = URL.createObjectURL(\n        new Blob([\"(\", work.toString(), \")()\"], {\n            type: \"application/javascript\",\n        })\n    );\n\n    const worker = new Worker(url);\n\n    URL.revokeObjectURL(url);\n\n    return worker;\n};\n","import { createWorker } from \"./loader.utils.mjs\";\n\n/**\n *\n * @private\n * @static\n */\nexport const work = () => {\n    onmessage = async (event) => {\n        const data = event.data;\n\n        // ...\n        let message;\n        try {\n            const response = await fetch(data.href, data.options);\n            const blob = await response.blob();\n\n            message = {\n                status: response.status,\n                statusText: response.statusText,\n                blob: blob,\n            };\n        } catch (e) {\n            message = {\n                status: 0,\n                statusText: e,\n            };\n        }\n\n        // ...\n        message.href = data.href;\n        postMessage(message);\n    };\n};\n\n// ...\nlet worker = null;\n\n/**\n *\n * @private\n */\nexport const getOrCreateWorker = () =>\n    worker ? worker : (worker = createWorker(work));\n\n/**\n *\n * @private\n */\nexport const possiblyTerminateWorker = () => {\n    // TODO: check if no longer in use\n    // worker.terminate();\n    // worker = null;\n};\n","import { getOrCreateWorker } from \"./loader.worker.mjs\";\n\n// ...\nconst cache = {};\n\n/**\n *\n * @private\n * @param {String} href\n * @param {Object} options\n */\nexport default async (href, options = {}) => {\n    // ...\n    if (href in cache) {\n        return await cache[href];\n    }\n\n    // ...\n    return (cache[href] = new Promise((resolve, reject) => {\n        const worker = getOrCreateWorker();\n\n        // ...\n        worker.postMessage({\n            href: href,\n            options: options.fetch,\n        });\n\n        // ...\n        worker.addEventListener(\"message\", (event) => {\n            const data = event.data;\n\n            // ...\n            if (data.href !== href) {\n                return;\n            }\n\n            // ...\n            if (data.status === 200) {\n                resolve(data.blob);\n\n                return;\n            }\n\n            // ...\n            reject(new Error(`${data.statusText} for ${data.href} resource.`));\n        });\n    }));\n};\n","import { getURL } from \"./loader.utils.mjs\";\nimport fetch from \"./loader.fetch.mjs\";\n\nexport default class Loader {\n    /**\n     *\n     * @param {Object} options\n     */\n    constructor(options) {\n        this.options = {\n            ...{ fetch: { cors: \"no-cors\" } },\n            ...options,\n        };\n    }\n\n    /**\n     *\n     * @param {Array.<String>|Array.<URL>|String|URL} arg\n     * @returns {Array.<Promise>|Promise}\n     */\n    async fetch(arg) {\n        // ...\n        if (Array.isArray(arg)) {\n            return await arg.map((a) => this.fetch(a));\n        }\n\n        // ...\n        if (typeof arg === \"string\") {\n            return await this.fetch(getURL(arg));\n        }\n\n        // ...\n        if (arg instanceof URL) {\n            return await fetch(arg.href, this.options);\n        }\n\n        // ...\n        throw new TypeError(\n            `Invalid argment of type ${typeof arg} passed to Loader class \"fetch\" method.`\n        );\n    }\n\n    /**\n     *\n     * @param {Array.<String>|Array.<URL>|String|URL} arg\n     * @returns {Array.<Promise>|Promise}\n     */\n    async load(arg, el) {\n        // ...\n        if (Array.isArray(arg)) {\n            return await arg.map((a) => this.load(a));\n        }\n\n        // ...\n        const blob = await this.fetch(arg);\n\n        //...\n        switch (blob.type) {\n            //...\n            case \"image/png\":\n            case \"image/jpeg\":\n                //\n                el = undefined === el ? new Image() : el;\n\n                //\n                const imageUrl = URL.createObjectURL(blob);\n\n                //\n                await new Promise((resolve, reject) => {\n                    el.onload = resolve;\n                    el.onerror = reject;\n\n                    el.src = imageUrl;\n                });\n\n                //\n                URL.revokeObjectURL(imageUrl);\n\n                //\n                return el;\n\n            //...\n            case \"text/html\":\n                return new Promise((resolve, reject) => {\n                    //\n                    const reader = new FileReader();\n\n                    //\n                    reader.addEventListener(\"loadend\", (load) =>\n                        resolve(load.srcElement.result)\n                    );\n\n                    // TODO: error?\n\n                    //\n                    reader.readAsText(blob);\n                });\n\n            //...\n            case \"text/css\":\n                //\n                el = undefined === el ? document : el;\n\n                //\n                const styleUrl = URL.createObjectURL(blob);\n\n                //\n                const sheet = new CSSStyleSheet();\n\n                //\n                await sheet.replace(`@import url(\"${styleUrl}\")`);\n\n                //\n                URL.revokeObjectURL(styleUrl);\n\n                //\n                if (\"adoptedStyleSheets\" in el) {\n                    el.adoptedStyleSheets = [...el.adoptedStyleSheets, sheet];\n                }\n\n                //\n                return sheet;\n\n            //...\n            case \"text/javascript\":\n                //\n                const jsUrl = URL.createObjectURL(blob);\n\n                //\n                const result = await import(jsUrl);\n\n                //\n                URL.revokeObjectURL(jsUrl);\n\n                //\n                return result;\n        }\n\n        // ...\n        throw new TypeError(\n            `Invalid argment of type ${typeof arg} passed to Loader class \"fetch\" method.`\n        );\n    }\n}\n"],"names":["fetch"],"mappings":"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"}