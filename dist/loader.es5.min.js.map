{"version":3,"sources":["loader.mjs"],"names":["ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","value","configurable","writable","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","prototype","asyncGeneratorStep","gen","resolve","reject","_next","_throw","arg","info","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","err","undefined","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","iter","Symbol","iterator","toString","call","Array","from","isArray","arr2","_typeof","constructor","global","factory","exports","module","define","amd","Loader","urlFromDataObject","data","blob","type","URL","createObjectURL","response","url","image","attributeName","el","Image","onload","onerror","setAttribute","style","document","createElement","sheet","CSSStyleSheet","promise","replace","concat","adoptedStyleSheets","script","tagName","preload","width","height","body","append","src","async","head","Loaders","freeze","__proto__","worker","_ref","onmessage","regeneratorRuntime","mark","_callee","event","wrap","_context","prev","next","fetch","sent","status","statusText","t0","postMessage","stop","_x","options","Worker","Blob","_options","_this","parsedUrl","a","href","parseUrl","host","window","location","isCORSUrl","defaultData","addEventListener","Error","e","revokeObjectURL","name","loader","querySelectorAll","dataset","x","setImageAttribute","console","adoptStyleSheet","insertScript"],"mappings":"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","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define('Loader', ['exports'], factory) :\n    (global = global || self, factory(global.Loader = {}));\n}(this, (function (exports) { 'use strict';\n\n    /**\n     *\n     * @param url\n     */\n    const parseUrl = url => {\n        const a = document.createElement(\"a\");\n        a.href = url;\n        return a;\n    };\n\n    /**\n     *\n     * @param data\n     */\n    const urlFromDataObject = data =>\n        data.blob.type ? URL.createObjectURL(data.blob) : data.response.url;\n\n    /**\n     * TODO: do it\n     * @param url\n     */\n    const getLoaderTypeFromUrl = url => \"image\";\n\n    /**\n     *\n     * @param url\n     */\n    const isCORSUrl = url => url.host !== window.location.host;\n\n    const image = (url, attributeName = \"src\", el = new Image()) =>\n        new Promise((resolve, reject) => {\n            el.onload = resolve;\n            el.onerror = reject;\n\n            el.setAttribute(attributeName, url);\n        });\n\n    const style = (url, el = document.createElement(\"div\")) => {\n        const sheet = new CSSStyleSheet();\n\n        const promise = sheet.replace(`@import url(\"${url}\")`);\n\n        if (\"adoptedStyleSheets\" in el) {\n            el.adoptedStyleSheets = [...el.adoptedStyleSheets, sheet];\n        }\n\n        return promise;\n    };\n\n    const object = (url, el) =>\n        new Promise((resolve, reject) => {\n            el.onload = resolve;\n            el.onerror = reject;\n\n            el.data = preload[i];\n\n            el.width = 0;\n            el.height = 0;\n\n            document.body.append(el);\n        });\n\n    const script = (url, el = document.createElement(\"object\")) =>\n        el.tagName === \"OBJECT\"\n            ? object(url, el)\n            : new Promise((resolve, reject) => {\n                  el.onload = resolve;\n                  el.onerror = reject;\n\n                  el.src = url;\n                  el.async = true;\n\n                  document.head.append(el);\n              });\n\n    var Loaders = /*#__PURE__*/Object.freeze({\n        __proto__: null,\n        image: image,\n        style: style,\n        script: script\n    });\n\n    var worker = () => {\n        onmessage = async event => {\n            let data = event.data;\n\n            try {\n                const response = await fetch(data.url);\n                const blob = await response.blob();\n\n                data.response = {\n                    url: response.url,\n                    status: response.status,\n                    statusText: response.statusText\n                };\n\n                data.blob = blob;\n            } catch (e) {\n                data.response = {\n                    url: data.url,\n                    status: 200\n                };\n\n                data.blob = { type: null };\n            }\n\n            postMessage(data);\n        };\n    };\n\n    class Loader {\n        /**\n         *\n         * @param {object} options\n         */\n        constructor(options = {}) {\n            this.worker = new Worker(\n                URL.createObjectURL(\n                    new Blob([\"(\", worker.toString(), \")()\"], {\n                        type: \"application/javascript\"\n                    })\n                )\n            );\n\n            this._options = { ...options, ...{} };\n        }\n\n        /**\n         * @param {string} url\n         * @returns {Promise}\n         */\n        fetch(url) {\n            const parsedUrl = parseUrl(url);\n\n            url = parsedUrl.href;\n\n            return new Promise((resolve, reject) => {\n                try {\n                    if (isCORSUrl(parsedUrl)) {\n                        const type = getLoaderTypeFromUrl(url);\n\n                        const defaultData = {\n                            response: {\n                                url: url,\n                                status: 200\n                            },\n                            blob: {\n                                type: null\n                            }\n                        };\n\n                        if (type in Loaders) {\n                            return Loaders[type](url)\n                                .then(() => resolve(defaultData))\n                                .catch(reject);\n                        }\n\n                        resolve(defaultData);\n\n                        return;\n                    }\n\n                    this.worker.postMessage({\n                        url: url\n                    });\n\n                    this.worker.addEventListener(\"message\", event => {\n                        const data = event.data;\n\n                        if (data.url !== url) {\n                            return;\n                        }\n\n                        if (data.response.status !== 200) {\n                            reject(\n                                new Error(\n                                    `${data.response.statusText} ${data.response.url}`\n                                )\n                            );\n\n                            return;\n                        }\n\n                        resolve(data);\n                    });\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        }\n\n        /**\n         *\n         * @param data\n         * @param el\n         */\n        static adoptStyleSheet(data) {\n            const url = urlFromDataObject(data);\n\n            return style(url, document).finally(() =>\n                URL.revokeObjectURL(url)\n            );\n        }\n\n        /**\n         *\n         * @param data\n         */\n        static insertScript(data) {\n            const url = urlFromDataObject(data);\n\n            return script(\n                url,\n                document.createElement(\"script\")\n            ).finally(() => URL.revokeObjectURL(url));\n        }\n\n        /**\n         *\n         * @param data\n         * @param el\n         * @param name\n         */\n        static setImageAttribute(data, el, name = \"src\") {\n            const url = urlFromDataObject(data);\n\n            return image(url, name, el).finally(() =>\n                URL.revokeObjectURL(url)\n            );\n        }\n    }\n\n    const loader = new Loader();\n\n    [...document.querySelectorAll(\"img[data-src]\")].forEach(el =>\n        loader\n            .fetch(el.dataset.src)\n            .then(x => Loader.setImageAttribute(x, el))\n            .catch(e => console.error(e))\n    );\n\n    loader\n        .fetch(\"dist/styles.css\")\n        .then(x => Loader.adoptStyleSheet(x))\n        .catch(e => console.error(e));\n\n    loader\n        .fetch(\"dist/extra.css\")\n        .then(x => Loader.adoptStyleSheet(x))\n        .catch(e => console.error(e));\n\n    loader\n        .fetch(\"dist/scripts.js\")\n        .then(x => Loader.insertScript(x))\n        .catch(e => console.error(e));\n\n    loader\n        .fetch(\"dist/not-existent.js\")\n        .then(x => Loader.insertScript(x))\n        .catch(e => console.error(e));\n\n    exports.Loader = Loader;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n})));\n"],"file":"loader.es5.min.js"}