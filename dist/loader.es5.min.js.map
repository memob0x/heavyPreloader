{"version":3,"sources":["loader.mjs"],"names":["ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","value","configurable","writable","asyncGeneratorStep","gen","resolve","reject","_next","_throw","arg","info","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","err","undefined","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","TypeError","iter","Symbol","iterator","prototype","toString","call","Array","from","isArray","arr2","_classCallCheck","instance","Constructor","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","_typeof","constructor","global","factory","exports","module","define","amd","Loader","_ref2","_ref3","prop","o","p","split","reduce","xs","x","getURL","a","document","createElement","href","URL","isSupportedElement","el","HTMLImageElement","HTMLPictureElement","HTMLSourceElement","HTMLVideoElement","HTMLAudioElement","getLoaderType","ext","isCORS","hostname","window","location","protocol","collection","WeakMap","build","data","url","blob","LoaderResource","override","has","get","set","Loaders","image","bool","Image","onload","onerror","src","loadImage","media","loadMedia","script","async","head","append","loadScript","width","height","body","loadObject","style","sheet","CSSStyleSheet","promise","replace","concat","adoptedStyleSheets","loadStyle","work","_ref","onmessage","regeneratorRuntime","mark","_callee","event","message","response","wrap","_context","prev","next","fetch","options","sent","status","statusText","t0","postMessage","stop","_x","worker","loaderWorker","createObjectURL","Blob","type","Worker","revokeObjectURL","createWorker","collection$1","_fetch","_callee2","resource","_args2","_context2","abrupt","r","cors","_load","addEventListener","Error","_x2","_callee3","_context3","_x3","_x4","_x5","_this","NodeList","map","isLoaderResource","_this2","load"],"mappings":"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","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Loader', factory) :\n    (global = global || self, global.Loader = factory());\n}(this, (function () { 'use strict';\n\n    /**\n     *\n     * @param {Object} o\n     * @param {String} p\n     */\n    const prop = (o, p) =>\n        p.split(\".\").reduce((xs, x) => (xs && xs[x] ? xs[x] : null), o);\n\n    /**\n     *\n     * @param {String|LoaderResource} url\n     * @returns {URL}\n     */\n    const getURL = arg => {\n        arg = prop(arg, \"url\") || arg;\n        arg = prop(arg, \"href\") || arg;\n\n        const a = document.createElement(\"a\");\n        a.href = arg;\n\n        return new URL(a);\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @returns {Boolean}\n     */\n    const isSupportedElement = el => {\n        return (\n            el instanceof HTMLImageElement ||\n            el instanceof HTMLPictureElement ||\n            el instanceof HTMLSourceElement ||\n            el instanceof HTMLVideoElement ||\n            el instanceof HTMLAudioElement\n        );\n    };\n\n    /**\n     *\n     * @param {Function} work\n     * @returns {Worker}\n     */\n    const createWorker = work => {\n        work = typeof work !== \"function\" ? () => {} : work;\n\n        const url = URL.createObjectURL(\n            new Blob([\"(\", work.toString(), \")()\"], {\n                type: \"application/javascript\"\n            })\n        );\n\n        const worker = new Worker(url);\n\n        URL.revokeObjectURL(url);\n\n        return worker;\n    };\n\n    /**\n     * TODO: check\n     * @param {String|LoaderResource} arg\n     */\n    const getLoaderType = arg => {\n        arg = getURL(arg).href;\n\n        let ext = arg.split(\".\");\n        ext = ext[ext.length - 1];\n\n        switch (ext) {\n            case \"jpg\":\n            case \"jpe\":\n            case \"jpeg\":\n            case \"jif\":\n            case \"jfi\":\n            case \"jfif\":\n            case \"gif\":\n            case \"tif\":\n            case \"tiff\":\n            case \"bmp\":\n            case \"dib\":\n            case \"webp\":\n            case \"ico\":\n            case \"cur\":\n            case \"svg\":\n            case \"png\":\n                return \"image\";\n            case \"css\":\n                return \"style\";\n            case \"js\":\n            case \"mjs\":\n                return \"script\";\n            case \"mp3\":\n            case \"ogg\":\n            case \"oga\":\n            case \"spx\":\n            case \"ogg\":\n            case \"wav\":\n            case \"mp4\":\n            case \"ogg\":\n            case \"ogv\":\n            case \"webm\":\n                return \"media\";\n            default:\n                return \"noop\";\n        }\n    };\n\n    /**\n     *\n     * @param {URL|String|LoaderResource} arg\n     * @returns {Boolean}\n     */\n    const isCORS = arg => {\n        arg = getURL(arg);\n\n        return (\n            arg.hostname !== window.location.hostname ||\n            arg.protocol !== window.location.protocol\n        );\n    };\n\n    // ...\n    const collection = new WeakMap();\n\n    // ...\n    const build = data => {\n        let o = {};\n\n        if (isSupportedElement(data)) {\n            o.el = data;\n            o.url = getURL(prop(o.el, \"dataset.src\")); // TODO: find a way to get currentSrc without triggering load\n        } else {\n            o.el = prop(data, \"el\");\n            o.url = data instanceof URL ? data : prop(data, \"url\");\n        }\n\n        o.blob = prop(data, \"blob\");\n\n        return o;\n    };\n\n    // ...\n    // TODO: refactor to avoid \"override\" param\n    class LoaderResource {\n        constructor(data, override) {\n            let o = build(data);\n\n            if (collection.has(o.url) && !override) {\n                o = collection.get(o.url);\n            }\n\n            if (collection.has(o.el) && !override) {\n                o = collection.get(o.el);\n            }\n\n            this.el = o.el;\n            this.url = o.url;\n            this.blob = o.blob;\n\n            collection.set(o.el || o.url, this);\n        }\n\n        static isLoaderResource(data) {\n            return data instanceof this;\n        }\n    }\n\n    const loadImage = (url, el = new Image()) =>\n        new Promise((resolve, reject) => {\n            el.onload = () => resolve(el);\n            el.onerror = reject;\n\n            el.src = url;\n        });\n\n    const loadMedia = (url, el = new Image()) =>\n        // TODO:\n        new Promise((resolve, reject) => {\n            el.onload = () => resolve(el);\n            el.onerror = reject;\n\n            el.src = url;\n        });\n\n    const loadStyle = (url, el = document.createElement(\"div\")) => {\n        const sheet = new CSSStyleSheet();\n\n        const promise = sheet.replace(`@import url(\"${url}\")`);\n\n        if (\"adoptedStyleSheets\" in el) {\n            el.adoptedStyleSheets = [...el.adoptedStyleSheets, sheet];\n        }\n\n        return promise;\n    };\n\n    const loadObject = (url, el = document.createElement(\"object\")) =>\n        new Promise((resolve, reject) => {\n            // TODO: check\n            el.onload = () => resolve(el);\n            el.onerror = reject;\n\n            el.data = url;\n\n            el.width = 0;\n            el.height = 0;\n\n            document.body.append(el);\n        });\n\n    const loadScript = (url, el = document.createElement(\"script\")) =>\n        new Promise((resolve, reject) => {\n            // TODO: check\n            el.onload = () => resolve(el);\n            el.onerror = reject;\n\n            el.src = url;\n            el.async = true;\n\n            document.head.append(el);\n        });\n\n    var Loaders = {\n        image: (url, bool, el) => loadImage(url, bool ? el : void 0),\n        media: (url, bool, el) => loadMedia(url, bool ? el : void 0),\n        script: (url, bool) => (bool ? loadScript(url) : loadObject(url)),\n        style: (url, bool) => loadStyle(url, bool ? document : void 0)\n    };\n\n    const work = () => {\n        onmessage = async event => {\n            const data = event.data;\n\n            // ...\n            let message;\n            try {\n                const response = await fetch(data.href, data.options);\n                const blob = await response.blob();\n\n                message = {\n                    status: response.status,\n                    statusText: response.statusText,\n                    blob: blob\n                };\n            } catch (e) {\n                message = {\n                    status: 0,\n                    statusText: e\n                };\n            }\n\n            // ...\n            message.href = data.href;\n            postMessage(message);\n        };\n    };\n\n    let worker = null;\n    var loaderWorker = () => {\n        // ...\n        if (worker) {\n            return worker;\n        }\n\n        // ...\n        return (worker = createWorker(work));\n    };\n\n    // ...\n    const collection$1 = {};\n\n    /**\n     *\n     * @param {LoaderResource} resource\n     * @param {Object} options\n     */\n    var _fetch = async (resource, options = {}) => {\n        // ...\n        if (resource.url.href in collection$1) {\n            return new Promise((resolve, reject) => {\n                collection$1[resource.url.href]\n                    .then(r =>\n                        resolve(\n                            new LoaderResource(\n                                {\n                                    el: resource.el,\n                                    blob: r.blob,\n                                    url: r.url\n                                },\n                                true\n                            )\n                        )\n                    )\n                    .catch(reject);\n            });\n        }\n\n        // ...\n        if (isCORS(resource) && options.fetch.cors !== \"no-cors\") {\n            return (collection$1[resource.url.href] = _load(\n                resource,\n                options,\n                false\n            ));\n        }\n\n        // ...\n        return (collection$1[resource.url.href] = new Promise((resolve, reject) => {\n            const worker = loaderWorker();\n\n            // ...\n            worker.postMessage({\n                href: resource.url.href,\n                options: options.fetch\n            });\n\n            // ...\n            worker.addEventListener(\"message\", event => {\n                const data = event.data;\n\n                // ...\n                if (data.href !== resource.url.href) {\n                    return;\n                }\n\n                // ...\n                if (data.status === 200) {\n                    resolve(\n                        new LoaderResource(\n                            {\n                                ...resource,\n                                ...{\n                                    blob: data.blob\n                                }\n                            },\n                            true\n                        )\n                    );\n\n                    return;\n                }\n\n                // ...\n                reject(new Error(`${data.statusText} ${data.href}`));\n            });\n        }));\n    };\n\n    /**\n     *\n     * @param {LoaderResource} resource\n     * @param {Object} options\n     */\n    var _load = async (resource, options, bool) => {\n        // ...\n        if (!isCORS(resource) || options.fetch.cors === \"no-cors\") {\n            try {\n                const el = resource.el;\n                resource = await _fetch(resource, options);\n                resource.el = el;\n            } catch (e) {}\n        }\n\n        // ...\n        const type = getLoaderType(resource);\n        if (!(type in Loaders)) {\n            return Promise.reject(new Error(\"invalid type\"));\n        }\n\n        // ...\n        const url = !!resource.blob\n            ? URL.createObjectURL(resource.blob)\n            : resource.url.href;\n\n        // ...\n        return new Promise((resolve, reject) =>\n            Loaders[type](url, bool, resource.el)\n                .finally(() => URL.revokeObjectURL(url))\n                .then(() => resolve(resource))\n                .catch(reject)\n        );\n    };\n\n    class Loader {\n        constructor(options) {\n            this.options = {\n                ...{\n                    fetch: {\n                        // this way fetch throws but you don't get double download\n                        // TODO: check if opt makes sense\n                        cors: \"no-cors\"\n                    }\n                },\n                ...options\n            };\n        }\n\n        /**\n         *\n         * @param {String|Array|LoaderResource|HTMLElement|NodeList} arg\n         * @returns {Array|Promise}\n         */\n        fetch(arg) {\n            // ...\n            if (arg instanceof NodeList) {\n                return this.fetch([...arg]);\n            }\n\n            // ...\n            if (Array.isArray(arg)) {\n                return arg.map(a => this.fetch(a));\n            }\n\n            // ...\n            if (typeof arg === \"string\") {\n                return this.fetch(getURL(arg));\n            }\n\n            // ...\n            if (isSupportedElement(arg) || arg instanceof URL) {\n                return this.fetch(new LoaderResource(arg));\n            }\n\n            // ...\n            if (LoaderResource.isLoaderResource(arg)) {\n                return _fetch(arg, this.options);\n            }\n\n            // ...\n            return Promise.reject(new Error(\"invalid argument\"));\n        }\n\n        /**\n         * @param {String|Array|LoaderResource|HTMLElement|NodeList|URL} arg\n         * @returns {Array|Promise}\n         */\n        load(arg) {\n            if (arg instanceof NodeList) {\n                return this.load([...arg]);\n            }\n\n            // ...\n            if (Array.isArray(arg)) {\n                return arg.map(a => this.load(a));\n            }\n\n            // ...\n            if (typeof arg === \"string\") {\n                return this.load(getURL(arg));\n            }\n\n            // ...\n            if (isSupportedElement(arg) || arg instanceof URL) {\n                return this.load(new LoaderResource(arg));\n            }\n\n            // ...\n            if (LoaderResource.isLoaderResource(arg)) {\n                return _load(arg, this.options, true);\n            }\n\n            // ...\n            return Promise.reject(new Error(\"invalid argument\"));\n        }\n    }\n\n    return Loader;\n\n})));\n"],"file":"loader.es5.min.js"}