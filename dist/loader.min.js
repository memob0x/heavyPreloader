!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Loader",t):(e=e||self).Loader=t()}(this,function(){"use strict";const e=(e,t)=>t.split(".").reduce((e,t)=>e&&e[t]?e[t]:null,e),t=t=>{t=e(t,"url")||t,t=e(t,"href")||t;const s=document.createElement("a");return s.href=t,new URL(s)},s=e=>e instanceof HTMLImageElement||e instanceof HTMLPictureElement||e instanceof HTMLSourceElement||e instanceof HTMLVideoElement||e instanceof HTMLAudioElement,r=new WeakMap,n=r=>{let n={};return s(r)?(n.el=r,n.url=t(e(n.el,"dataset.src"))):(n.el=e(r,"el"),n.url=r instanceof URL?r:e(r,"url")),n.blob=e(r,"blob"),n};class o{constructor(e,t){let s=n(e);r.has(s.url)&&!t&&(s=r.get(s.url)),r.has(s.el)&&!t&&(s=r.get(s.el)),this.el=s.el,this.url=s.url,this.blob=s.blob,r.set(s.el||s.url,this)}static isLoaderResource(e){return e instanceof this}}var a={image:(e,t)=>((e,t=new Image)=>new Promise((s,r)=>{t.onload=(()=>s(t)),t.onerror=r,t.src=e}))(e,t),script:e=>((e,t=document.createElement("script"))=>new Promise((s,r)=>{t.onload=(()=>s(t)),t.onerror=r,t.src=e,t.async=!0,document.head.append(t)}))(e),style:e=>((e,t=document.createElement("div"))=>{const s=new CSSStyleSheet,r=s.replace(`@import url("${e}")`);return"adoptedStyleSheets"in t&&(t.adoptedStyleSheets=[...t.adoptedStyleSheets,s]),r})(e,document)};const c=()=>{onmessage=(async e=>{const t=e.data;let s;try{const e=await fetch(t.href,t.options),r=await e.blob();s={status:e.status,statusText:e.statusText,blob:r}}catch(e){s={status:0,statusText:e}}s.href=t.href,postMessage(s)})};let i=null;var l=()=>i||(i=(e=>{e="function"!=typeof e?()=>{}:e;const t=URL.createObjectURL(new Blob(["(",e.toString(),")()"],{type:"application/javascript"})),s=new Worker(t);return URL.revokeObjectURL(t),s})(c));const u={};var f=async(e,t={})=>{if(e.url.href in u){const t=e.el;return e=await u[e.url.href],new o({...e,el:t},!0)}return u[e.url.href]=new Promise((s,r)=>{const n=l();n.postMessage({href:e.url.href,options:t.fetch}),n.addEventListener("message",t=>{const n=t.data;if(n.href===e.url.href)return 200===n.status?(e=new o({...e,blob:n.blob},!0),void s(e)):void r(new Error(`${n.statusText} ${n.href}`))})})},d=async(e,s)=>{const r=e.el;try{(e=await f(e,s)).el=r}catch(e){}const n=(e=>{switch(e=t(e).href.split(/\#|\?/)[0].split(".").pop().trim()){case"jpg":case"jpe":case"jpeg":case"jif":case"jfi":case"jfif":case"gif":case"tif":case"tiff":case"bmp":case"dib":case"webp":case"ico":case"cur":case"svg":case"png":return"image";case"css":return"style";case"js":case"mjs":return"script";default:return null}})(e);if(!(n in a))throw new Error("invalid type");const o=e.blob?URL.createObjectURL(e.blob):e.url.href;return await a[n](o,e.el).finally(()=>URL.revokeObjectURL(o)),e};return class{constructor(e){this.options={fetch:{cors:"no-cors"},...e}}fetch(e){return e instanceof NodeList?this.fetch([...e]):Array.isArray(e)?e.map(e=>this.fetch(e)):"string"==typeof e?this.fetch(t(e)):s(e)||e instanceof URL?this.fetch(new o(e)):o.isLoaderResource(e)?f(e,this.options):Promise.reject(new Error("invalid argument"))}load(e){return e instanceof NodeList?this.load([...e]):Array.isArray(e)?e.map(e=>this.load(e)):"string"==typeof e?this.load(t(e)):s(e)||e instanceof URL?this.load(new o(e)):o.isLoaderResource(e)?d(e,this.options):Promise.reject(new Error("invalid argument"))}}});
//# sourceMappingURL=loader.min.js.map
