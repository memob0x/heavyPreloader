!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Loader",t):(e=e||self).Loader=t()}(this,function(){"use strict";const e=(e,t)=>t.split(".").reduce((e,t)=>e&&e[t]?e[t]:null,e),t=t=>{t=e(t,"url")||t,t=e(t,"href")||t;const r=document.createElement("a");return r.href=t,new URL(r)},r=e=>e instanceof HTMLImageElement||e instanceof HTMLPictureElement||e instanceof HTMLSourceElement||e instanceof HTMLVideoElement||e instanceof HTMLAudioElement,s=e=>(e=t(e)).hostname!==window.location.hostname||e.protocol!==window.location.protocol,o=new WeakMap,n=s=>{let o={};return r(s)?(o.el=s,o.url=t(e(o.el,"dataset.src"))):(o.el=e(s,"el"),o.url=s instanceof URL?s:e(s,"url")),o.blob=e(s,"blob"),o};class a{constructor(e,t){let r=n(e);o.has(r.url)&&!t&&(r=o.get(r.url)),o.has(r.el)&&!t&&(r=o.get(r.el)),this.el=r.el,this.url=r.url,this.blob=r.blob,o.set(r.el||r.url,this)}static isLoaderResource(e){return e instanceof this}}var c={image:(e,t,r)=>((e,t=new Image)=>new Promise((r,s)=>{t.onload=(()=>r(t)),t.onerror=s,t.src=e}))(e,t?r:void 0),script:(e,t)=>t?((e,t=document.createElement("script"))=>new Promise((r,s)=>{t.onload=(()=>r(t)),t.onerror=s,t.src=e,t.async=!0,document.head.append(t)}))(e):((e,t=document.createElement("object"))=>new Promise((r,s)=>{t.onload=(()=>r(t)),t.onerror=s,t.data=e,t.width=0,t.height=0,document.body.append(t)}))(e),style:(e,t)=>((e,t=document.createElement("div"))=>{const r=new CSSStyleSheet,s=r.replace(`@import url("${e}")`);return"adoptedStyleSheets"in t&&(t.adoptedStyleSheets=[...t.adoptedStyleSheets,r]),s})(e,t?document:void 0)};const i=()=>{onmessage=(async e=>{const t=e.data;let r;try{const e=await fetch(t.href,t.options),s=await e.blob();r={status:e.status,statusText:e.statusText,blob:s}}catch(e){r={status:0,statusText:e}}r.href=t.href,postMessage(r)})};let l=null;var u=()=>l||(l=(e=>{e="function"!=typeof e?()=>{}:e;const t=URL.createObjectURL(new Blob(["(",e.toString(),")()"],{type:"application/javascript"})),r=new Worker(t);return URL.revokeObjectURL(t),r})(i));const f={};var d=async(e,t={})=>{if(e.url.href in f){const t=e.el;return e=await f[e.url.href],new a({...e,el:t},!0)}return s(e)&&"no-cors"!==t.fetch.cors?f[e.url.href]=h(e,t,!1):f[e.url.href]=new Promise((r,s)=>{const o=u();o.postMessage({href:e.url.href,options:t.fetch}),o.addEventListener("message",t=>{const o=t.data;if(o.href===e.url.href)return 200===o.status?(e=new a({...e,blob:o.blob},!0),void r(e)):void s(new Error(`${o.statusText} ${o.href}`))})})},h=async(e,r,o)=>{if(!s(e)||"no-cors"===r.fetch.cors){const t=e.el;(e=await d(e,r)).el=t}const n=(e=>{switch(e=t(e).href.split(/\#|\?/)[0].split(".").pop().trim()){case"jpg":case"jpe":case"jpeg":case"jif":case"jfi":case"jfif":case"gif":case"tif":case"tiff":case"bmp":case"dib":case"webp":case"ico":case"cur":case"svg":case"png":return"image";case"css":return"style";case"js":case"mjs":return"script";default:return null}})(e);if(!(n in c))throw new Error("invalid type");const a=e.blob?URL.createObjectURL(e.blob):e.url.href;return await c[n](a,o,e.el).finally(()=>URL.revokeObjectURL(a)),e};return class{constructor(e){this.options={fetch:{cors:"no-cors"},...e}}fetch(e){return e instanceof NodeList?this.fetch([...e]):Array.isArray(e)?e.map(e=>this.fetch(e)):"string"==typeof e?this.fetch(t(e)):r(e)||e instanceof URL?this.fetch(new a(e)):a.isLoaderResource(e)?d(e,this.options):Promise.reject(new Error("invalid argument"))}load(e){return e instanceof NodeList?this.load([...e]):Array.isArray(e)?e.map(e=>this.load(e)):"string"==typeof e?this.load(t(e)):r(e)||e instanceof URL?this.load(new a(e)):a.isLoaderResource(e)?h(e,this.options,!0):Promise.reject(new Error("invalid argument"))}}});
//# sourceMappingURL=loader.min.js.map
