!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Loader",t):(e=e||self).Loader=t()}(this,function(){"use strict";const e=(e,t)=>t.split(".").reduce((e,t)=>e&&e[t]?e[t]:null,e),t=t=>{t=e(t,"url")||t,t=e(t,"href")||t;const r=document.createElement("a");return r.href=t,new URL(r)},r=e=>e instanceof HTMLImageElement||e instanceof HTMLPictureElement||e instanceof HTMLSourceElement||e instanceof HTMLVideoElement||e instanceof HTMLAudioElement,o=e=>(e=t(e)).hostname!==window.location.hostname||e.protocol!==window.location.protocol,n={},s=o=>{let n={};return r(o)?(n.el=o,n.url=t(e(n.el,"dataset.src"))):(n.el=e(o,"el"),n.url=o instanceof URL?o:e(o,"url")),n.blob=e(o,"blob"),n};class i{constructor(e,t){let r=s(e);r.url.href in n&&!t&&(r=n[r.url.href]),this.el=r.el,this.url=r.url,this.blob=r.blob,n[this.url.href]=this}static isLoaderResource(e){return e instanceof this}}var a={image:(e,t,r)=>((e,t=new Image)=>new Promise((r,o)=>{t.onload=(()=>r(t)),t.onerror=o,t.src=e}))(e,t?r:void 0),media:(e,t,r)=>((e,t=new Image)=>new Promise((r,o)=>{t.onload=(()=>r(t)),t.onerror=o,t.src=e}))(e,t?r:void 0),script:(e,t)=>t?((e,t=document.createElement("script"))=>new Promise((r,o)=>{t.onload=(()=>r(t)),t.onerror=o,t.src=e,t.async=!0,document.head.append(t)}))(e):((e,t=document.createElement("object"))=>new Promise((r,o)=>{t.onload=(()=>r(t)),t.onerror=o,t.data=e,t.width=0,t.height=0,document.body.append(t)}))(e),style:(e,t)=>((e,t=document.createElement("div"))=>{const r=new CSSStyleSheet,o=r.replace(`@import url("${e}")`);return"adoptedStyleSheets"in t&&(t.adoptedStyleSheets=[...t.adoptedStyleSheets,r]),o})(e,t?document:void 0)},c=(e,r)=>{const o=(e=>{let r=(e=t(e).href).split(".");switch(r=r[r.length-1]){case"jpg":return"image";case"css":return"style";case"js":return"script";default:return"noop"}})(e);if(!(o in a))return Promise.reject(new Error("invalid type"));const n=e.blob?URL.createObjectURL(e.blob):e.url.href;return new Promise((t,s)=>a[o](n,r,e.el).finally(()=>URL.revokeObjectURL(n)).then(()=>t(e)).catch(s))};const l=()=>{onmessage=(async e=>{const t=e.data;let r;try{const e=await fetch(t.href,t.options),o=await e.blob();r={status:e.status,statusText:e.statusText,blob:o}}catch(e){r={status:0,statusText:e}}r.href=t.href,postMessage(r)})};let u=null;var h=()=>u||(u=(e=>{e="function"!=typeof e?()=>{}:e;const t=URL.createObjectURL(new Blob(["(",e.toString(),")()"],{type:"application/javascript"})),r=new Worker(t);return URL.revokeObjectURL(t),r})(l));const f={};var d=(e,t={})=>e.url.href in f?f[e.url.href]:o(e)&&"no-cors"!==t.cors?f[e.url.href]=c(e,!1):f[e.url.href]=new Promise((r,o)=>{const n=h();n.postMessage({href:e.url.href,options:t}),n.addEventListener("message",t=>{const n=t.data;n.href===e.url.href&&(200!==n.status?o(new Error(`${n.statusText} ${n.href}`)):r(new i({...e,blob:n.blob},!0)))})});return class{constructor(e){this.options={fetch:{},...e}}fetch(e){return e instanceof NodeList?this.fetch([...e]):Array.isArray(e)?e.map(e=>this.fetch(e)):"string"==typeof e?this.fetch(t(e)):r(e)||e instanceof URL?this.fetch(new i(e)):i.isLoaderResource(e)?d(e,this.options.fetch):Promise.reject(new Error("invalid argument"))}async load(e){if(e instanceof NodeList)return this.load([...e]);if(Array.isArray(e))return e.map(e=>this.load(e));if("string"==typeof e)return this.load(t(e));if(r(e)||e instanceof URL)return this.load(new i(e));if(!o(e)||"no-cors"===this.options.fetch.cors)try{e=await this.fetch(e)}catch(e){console.warn(e)}return i.isLoaderResource(e)?c(e,!0):Promise.reject(new Error("invalid argument"))}}});
//# sourceMappingURL=loader.min.js.map
