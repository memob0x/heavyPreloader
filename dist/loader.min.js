!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Loader",t):(e=e||self).Loader=t()}(this,function(){"use strict";const e=(e,t)=>t.split(".").reduce((e,t)=>e&&e[t]?e[t]:null,e),t=t=>{t=e(t,"url")||t,t=e(t,"href")||t;const s=document.createElement("a");return s.href=t,new URL(s)},s=e=>e instanceof HTMLImageElement||e instanceof HTMLPictureElement||e instanceof HTMLSourceElement||e instanceof HTMLVideoElement||e instanceof HTMLAudioElement,o=e=>(e=t(e)).hostname!==window.location.hostname||e.protocol!==window.location.protocol,r=new WeakMap,n=o=>{let r={};return s(o)?(r.el=o,r.url=t(e(r.el,"dataset.src"))):(r.el=e(o,"el"),r.url=o instanceof URL?o:e(o,"url")),r.blob=e(o,"blob"),r};class a{constructor(e,t){let s=n(e);r.has(s.url)&&!t&&(s=r.get(s.url)),r.has(s.el)&&!t&&(s=r.get(s.el)),this.el=s.el,this.url=s.url,this.blob=s.blob,r.set(s.el||s.url,this)}static isLoaderResource(e){return e instanceof this}}var c={image:(e,t,s)=>((e,t=new Image)=>new Promise((s,o)=>{t.onload=(()=>s(t)),t.onerror=o,t.src=e}))(e,t?s:void 0),media:(e,t,s)=>((e,t=new Image)=>new Promise((s,o)=>{t.onload=(()=>s(t)),t.onerror=o,t.src=e}))(e,t?s:void 0),script:(e,t)=>t?((e,t=document.createElement("script"))=>new Promise((s,o)=>{t.onload=(()=>s(t)),t.onerror=o,t.src=e,t.async=!0,document.head.append(t)}))(e):((e,t=document.createElement("object"))=>new Promise((s,o)=>{t.onload=(()=>s(t)),t.onerror=o,t.data=e,t.width=0,t.height=0,document.body.append(t)}))(e),style:(e,t)=>((e,t=document.createElement("div"))=>{const s=new CSSStyleSheet,o=s.replace(`@import url("${e}")`);return"adoptedStyleSheets"in t&&(t.adoptedStyleSheets=[...t.adoptedStyleSheets,s]),o})(e,t?document:void 0)};const i=()=>{onmessage=(async e=>{const t=e.data;let s;try{const e=await fetch(t.href,t.options),o=await e.blob();s={status:e.status,statusText:e.statusText,blob:o}}catch(e){s={status:0,statusText:e}}s.href=t.href,postMessage(s)})};let l=null;var u=()=>l||(l=(e=>{e="function"!=typeof e?()=>{}:e;const t=URL.createObjectURL(new Blob(["(",e.toString(),")()"],{type:"application/javascript"})),s=new Worker(t);return URL.revokeObjectURL(t),s})(i));const d={};var f=async(e,t={})=>e.url.href in d?d[e.url.href]:o(e)&&"no-cors"!==t.fetch.cors?d[e.url.href]=h(e,t,!1):d[e.url.href]=new Promise((s,o)=>{const r=u();r.postMessage({href:e.url.href,options:t.fetch}),r.addEventListener("message",t=>{const r=t.data;r.href===e.url.href&&(200!==r.status?o(new Error(`${r.statusText} ${r.href}`)):s(new a({...e,blob:r.blob},!0)))})}),h=async(e,s,r)=>{if(!o(e)||"no-cors"===s.fetch.cors)try{const t=e.el;(e=await f(e,s)).el=t}catch(e){}const n=(e=>{let s=(e=t(e).href).split(".");switch(s=s[s.length-1]){case"jpg":case"jpe":case"jpeg":case"jif":case"jfi":case"jfif":case"gif":case"tif":case"tiff":case"bmp":case"dib":case"webp":case"ico":case"cur":case"svg":case"png":return"image";case"css":return"style";case"js":case"mjs":return"script";case"mp3":case"ogg":case"oga":case"spx":case"ogg":case"wav":case"mp4":case"ogg":case"ogv":case"webm":return"media";default:return"noop"}})(e);if(!(n in c))return Promise.reject(new Error("invalid type"));const a=e.blob?URL.createObjectURL(e.blob):e.url.href;return new Promise((t,s)=>c[n](a,r,e.el).finally(()=>URL.revokeObjectURL(a)).then(()=>t(e)).catch(s))};return class{constructor(e){this.options={fetch:{cors:"no-cors"},...e}}fetch(e){return e instanceof NodeList?this.fetch([...e]):Array.isArray(e)?e.map(e=>this.fetch(e)):"string"==typeof e?this.fetch(t(e)):s(e)||e instanceof URL?this.fetch(new a(e)):a.isLoaderResource(e)?f(e,this.options):Promise.reject(new Error("invalid argument"))}load(e){return e instanceof NodeList?this.load([...e]):Array.isArray(e)?e.map(e=>this.load(e)):"string"==typeof e?this.load(t(e)):s(e)||e instanceof URL?this.load(new a(e)):a.isLoaderResource(e)?h(e,this.options,!0):Promise.reject(new Error("invalid argument"))}}});
//# sourceMappingURL=loader.min.js.map
